<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loto Fácil Analytics Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6bff;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --white: #ffffff;
            --gray: #6c757d;
            --gray-light: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 28px;
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .welcome {
            margin-right: 10px;
            font-weight: 500;
        }
        
        .btn {
            display: inline-block;
            padding: 8px 16px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-primary {
            background-color: var(--primary);
        }
        
        .btn-secondary {
            background-color: var(--secondary);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: #333;
        }
        
        .btn-info {
            background-color: var(--info);
        }
        
        .btn-icon {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
        }
        
        .btn-icon:hover {
            color: var(--danger);
        }
        
        .flex-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .col {
            flex: 1;
            min-width: 300px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .animate {
            transition: all 0.3s ease;
        }
        
        .animate:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loader {
            padding: 15px;
            text-align: center;
            color: var(--primary);
            font-weight: bold;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f5f7fa;
        }
        
        .login-card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .login-card h2 {
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
        }
        
        .demo-credentials {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* Números */
        .numeros-jogo, .numeros-sorteio {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        
        .numero {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .numero-atrasado {
            background-color: var(--danger);
        }
        
        .numero-quente {
            background-color: var(--success);
        }
        
        .numero-raro {
            background-color: var(--warning);
            color: #333;
        }
        
        /* Frequência */
        .frequencia-chart {
            display: flex;
            height: 200px;
            align-items: flex-end;
            gap: 5px;
            margin: 20px 0;
        }
        
        .frequencia-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .frequencia-bar {
            width: 100%;
            background-color: var(--primary);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
        }
        
        .frequencia-label {
            margin-top: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .frequencia-legenda {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .legenda-color {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 5px;
        }
        
        .legenda-color.max {
            background-color: var(--primary);
        }
        
        .legenda-color.min {
            background-color: var(--secondary);
        }
        
        /* Estatísticas */
        .estatisticas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .dezenas-distribuicao {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .dezenas-distribuicao > div {
            flex: 1;
        }
        
        .dezena-bar {
            height: 10px;
            background-color: var(--primary);
            border-radius: 5px;
            margin: 5px 0;
        }
        
        /* Ciclos */
        .ciclos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .ciclo-item {
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .ciclo-item.destaque {
            background-color: #fff3cd;
            border-left: 3px solid var(--warning);
        }
        
        .numero-ciclo {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .ciclo-bar-container {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        .ciclo-bar {
            height: 5px;
            background-color: var(--danger);
            border-radius: 5px;
        }
        
        .ciclo-value {
            margin-left: 5px;
            font-size: 12px;
            color: var(--gray);
        }
        
        .ciclo-actions {
            margin-top: 15px;
            text-align: center;
        }
        
        /* Estratégias */
        .estrategias-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .estrategia-item {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid var(--primary);
        }
        
        .estrategia-item h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .referencia {
            display: block;
            margin: 5px 0;
            color: var(--gray);
            font-style: italic;
        }
        
        /* Jogos Gerados */
        .jogos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .jogo-card {
            padding: 15px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 3px solid var(--primary);
        }
        
        .jogo-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .jogo-id {
            font-weight: bold;
        }
        
        .estrategia-badge {
            font-size: 12px;
            background-color: var(--gray-light);
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .jogo-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .jogo-footer small {
            color: var(--gray);
            font-size: 12px;
        }
        
        .no-games {
            text-align: center;
            color: var(--gray);
            padding: 20px;
        }
        
        /* Histórico */
        .historico-table-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .historico-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .historico-table th, .historico-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .historico-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 10px;
            font-size: 24px;
            cursor: pointer;
        }
        
        .admin-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-section:last-child {
            border-bottom: none;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .user-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .flex-grid {
                flex-direction: column;
            }
            
            .dezenas-distribuicao {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const LotoFacilApp = {
            state: {
                user: null,
                resultados: [],
                frequenciaNumeros: Array(25).fill(0),
                ultimosResultadosAnalisados: [],
                estatisticasCalculadas: false,
                filtros: {
                    periodo: 'all',
                    anoInicio: null,
                    anoFim: null,
                    estrategia: 'completo',
                    dezenas: 15 // Padrão para 15 dezenas
                },
                loading: false,
                error: null,
                estrategias: [
                    {
                        id: 'aleatorio',
                        nome: "Aleatório Puro",
                        descricao: "Gera números completamente aleatórios",
                        referencia: "Probabilidade básica"
                    },
                    {
                        id: 'balanceado',
                        nome: "Pares e Ímpares Balanceados",
                        descricao: "Jogar com 7-8 números pares e 7-8 números ímpares",
                        referencia: "Baseado na distribuição histórica"
                    },
                    {
                        id: 'dezenas',
                        nome: "Dezenas Distribuídas",
                        descricao: "Selecionar números de todas as dezenas (1-10, 11-20, 21-25)",
                        referencia: "Estatísticas de distribuição"
                    },
                    {
                        id: 'quentes',
                        nome: "Números Quentes",
                        descricao: "Incluir 5-6 números que saíram nos últimos 5 concursos",
                        referencia: "Tendência de números recentes"
                    },
                    {
                        id: 'frios',
                        nome: "Números Frios",
                        descricao: "Incluir 2-3 números que não saem há mais de 10 concursos",
                        referencia: "Lei dos atrasados"
                    },
                    {
                        id: 'dezenasforadociclo',
                        nome: "Dezenas Fora do Ciclo",
                        descricao: "Incluir números que não saem há mais de 5 concursos",
                        referencia: "Estratégia de atraso"
                    },
                    {
                        id: 'ciclos',
                        nome: "Ciclos de Dezenas",
                        descricao: "Gerar jogo com as dezenas que estão há mais tempo fora de sorteio",
                        referencia: "Cálculo dos ciclos de atraso"
                    },
                    {
                        id: 'completo',
                        nome: "Estratégia Completa",
                        descricao: "Combina múltiplas estratégias para maior cobertura",
                        referencia: "Análise estatística avançada"
                    }
                ],
                jogosGerados: [],
                estatisticasAvancadas: {
                    atrasos: {},
                    sequencias: [],
                    padroes: []
                }
            },

            init() {
                this.setupEventListeners();
                this.checkLocalStorage();
                this.render();
            },

            async checkLocalStorage() {
                const user = localStorage.getItem('lotoUser');
                if (user) {
                    this.setState({ user: JSON.parse(user) });
                    await this.loadData();
                }
            },

            async loadData() {
                this.setState({ loading: true, error: null });
                try {
                    // Tenta primeiro a API oficial da Caixa
                    let response = await fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil');
                    
                    if (!response.ok) {
                        // Se a API oficial falhar, tenta uma fonte alternativa
                        response = await fetch('https://lotodicas.com.br/api/v2/lotofacil/results');
                        if (!response.ok) throw new Error('Erro ao carregar dados das APIs');
                        
                        const data = await response.json();
                        const resultadosFormatados = data.map(item => ({
                            concurso: item.concurso,
                            data: item.data,
                            numeros: item.dezenas.map(Number).sort((a, b) => a - b)
                        })).reverse();
                        
                        this.setState({
                            resultados: resultadosFormatados,
                            ultimosResultadosAnalisados: resultadosFormatados,
                            loading: false
                        });
                    } else {
                        // Processa resposta da API oficial
                        const data = await response.json();
                        const resultadosFormatados = data.map(item => ({
                            concurso: item.numero,
                            data: item.dataApuracao,
                            numeros: item.listaDezenas.map(Number).sort((a, b) => a - b)
                        })).reverse();
                        
                        this.setState({
                            resultados: resultadosFormatados,
                            ultimosResultadosAnalisados: resultadosFormatados,
                            loading: false
                        });
                    }
                    
                    this.calcularFrequenciaNumeros(this.state.resultados);
                    this.calcularEstatisticasAvancadas(this.state.resultados);
                    this.salvarDadosLocal(this.state.resultados);
                    
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    this.carregarDadosLocal();
                }
            },

            async carregarDadosLocal() {
                try {
                    const savedData = localStorage.getItem('lotoResults');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        this.setState({
                            resultados: data,
                            ultimosResultadosAnalisados: data,
                            loading: false
                        });
                        this.calcularFrequenciaNumeros(data);
                        this.calcularEstatisticasAvancadas(data);
                        return;
                    }
                    
                    // Fallback para dados de exemplo
                    this.carregarDadosExemplo();
                } catch (e) {
                    this.carregarDadosExemplo();
                }
            },

            salvarDadosLocal(data) {
                try {
                    localStorage.setItem('lotoResults', JSON.stringify(data));
                } catch (e) {
                    console.warn('Não foi possível salvar dados localmente');
                }
            },

            carregarDadosExemplo() {
                const hoje = new Date();
                const dados = [];
                
                // Gera 50 concursos de exemplo com padrões variados
                for (let i = 1; i <= 50; i++) {
                    const data = new Date();
                    data.setDate(hoje.getDate() - (i * 7));
                    
                    const numeros = this.gerarJogoCompleto(15); // Usa a estratégia completa para dados mais realistas
                    
                    dados.push({
                        concurso: i,
                        data: data.toLocaleDateString('pt-BR'),
                        numeros: numeros.sort((a, b) => a - b)
                    });
                }
                
                this.setState({
                    resultados: dados,
                    ultimosResultadosAnalisados: dados,
                    loading: false,
                    error: 'Usando dados de exemplo (API indisponível)'
                });
                
                this.calcularFrequenciaNumeros(dados);
                this.calcularEstatisticasAvancadas(dados);
            },

            calcularFrequenciaNumeros(resultados) {
                const frequencia = Array(25).fill(0);
                resultados.forEach(resultado => {
                    resultado.numeros.forEach(numero => {
                        frequencia[numero - 1]++;
                    });
                });
                
                this.setState({ frequenciaNumeros: frequencia });
            },

            calcularEstatisticasAvancadas(resultados) {
                if (resultados.length === 0) return;
                
                // Calcula atrasos
                const atrasos = {};
                for (let i = 1; i <= 25; i++) {
                    let atraso = 0;
                    for (let j = resultados.length - 1; j >= 0; j--) {
                        if (resultados[j].numeros.includes(i)) break;
                        atraso++;
                    }
                    atrasos[i] = atraso;
                }
                
                // Calcula sequências mais comuns
                const sequencias = {};
                resultados.forEach(resultado => {
                    const nums = resultado.numeros;
                    for (let i = 0; i < nums.length - 1; i++) {
                        const seq = `${nums[i]}-${nums[i+1]}`;
                        sequencias[seq] = (sequencias[seq] || 0) + 1;
                    }
                });
                
                // Ordena sequências por frequência
                const sequenciasOrdenadas = Object.entries(sequencias)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);
                
                // Padrões de dezenas
                const padroesDezenas = Array(3).fill(0); // 1-10, 11-20, 21-25
                resultados.forEach(resultado => {
                    resultado.numeros.forEach(num => {
                        if (num <= 10) padroesDezenas[0]++;
                        else if (num <= 20) padroesDezenas[1]++;
                        else padroesDezenas[2]++;
                    });
                });
                
                this.setState({
                    estatisticasAvancadas: {
                        atrasos,
                        sequencias: sequenciasOrdenadas,
                        padroes: padroesDezenas
                    },
                    estatisticasCalculadas: true
                });
            },

            setState(newState) {
                this.state = { ...this.state, ...newState };
                this.render();
            },

            render() {
                const app = document.getElementById('app');
                if (!this.state.user) {
                    app.innerHTML = this.loginTemplate();
                    return;
                }
                
                app.innerHTML = `
                    <div class="container">
                        <header class="header">
                            <h1>Loto Fácil Analytics Pro</h1>
                            <div class="user-actions">
                                <span class="welcome">Bem-vindo, ${this.state.user.username}</span>
                                <button class="btn btn-danger" onclick="LotoFacilApp.logout()">Sair</button>
                                ${this.state.user?.username === 'admin' ? `
                                    <button class="btn btn-warning" onclick="LotoFacilApp.mostrarPainelAdmin()">Painel Admin</button>
                                ` : ''}
                            </div>
                        </header>

                        ${this.state.error ? `<div class="alert alert-warning">${this.state.error}</div>` : ''}
                        ${this.state.loading ? `<div class="loader">Carregando...</div>` : ''}

                        <div class="filtros-section">
                            ${this.filtrosTemplate()}
                        </div>

                        <div class="flex-grid">
                            <div class="col">
                                ${this.geradorTemplate()}
                            </div>
                            <div class="col">
                                ${this.analiseTemplate()}
                            </div>
                        </div>

                        ${this.estatisticasTemplate()}
                        ${this.ciclosTemplate()}
                        ${this.estrategiasTemplate()}
                        ${this.verificadorTemplate()}
                        ${this.historicoTemplate()}
                    </div>
                `;
                
                if (this.state.user?.username === 'admin') {
                    this.renderPainelAdmin();
                }
            },

            // TEMPLATES
            loginTemplate() {
                return `
                    <div class="login-container">
                        <div class="login-card animate">
                            <h2>Acesso ao Sistema</h2>
                            <form onsubmit="event.preventDefault(); LotoFacilApp.handleLogin()">
                                <div class="form-group">
                                    <label>Usuário:</label>
                                    <input type="text" id="username" required>
                                </div>
                                <div class="form-group">
                                    <label>Senha:</label>
                                    <input type="password" id="password" required>
                                </div>
                                <button type="submit" class="btn">Entrar</button>
                            </form>
                            <div class="demo-credentials">
                                <p>Dados para teste:</p>
                                <p>Usuário: <strong>user</strong> | Senha: <strong>123</strong></p>
                                <p>Admin: <strong>admin</strong> | Senha: <strong>admin123</strong></p>
                            </div>
                        </div>
                    </div>
                `;
            },

            filtrosTemplate() {
                return `
                    <div class="card filtros-card">
                        <h3>Filtros de Análise</h3>
                        <div class="filtros-grid">
                            <div>
                                <label>Período:</label>
                                <select id="filtroPeriodo" class="form-control">
                                    <option value="all">Todos os resultados</option>
                                    <option value="month">Último mês</option>
                                    <option value="year">Último ano</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                            <div id="customRange" style="display: none;">
                                <label>Ano inicial:</label>
                                <input type="number" id="anoInicio" min="2000" max="${new Date().getFullYear()}" class="form-control">
                                
                                <label>Ano final:</label>
                                <input type="number" id="anoFim" min="2000" max="${new Date().getFullYear()}" class="form-control">
                            </div>
                            <div>
                                <button class="btn" onclick="LotoFacilApp.aplicarFiltros()">Aplicar Filtros</button>
                            </div>
                        </div>
                    </div>
                `;
            },

            geradorTemplate() {
                return `
                    <div class="card animate">
                        <h2>Gerador de Jogos Inteligente</h2>
                        <div class="form-group">
                            <label>Quantidade de jogos:</label>
                            <input type="number" id="quantidadeJogos" min="1" max="20" value="5" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Quantidade de dezenas por jogo:</label>
                            <select id="quantidadeDezenas" class="form-control">
                                <option value="15" ${this.state.filtros.dezenas === 15 ? 'selected' : ''}>15 dezenas</option>
                                <option value="16" ${this.state.filtros.dezenas === 16 ? 'selected' : ''}>16 dezenas</option>
                                <option value="17" ${this.state.filtros.dezenas === 17 ? 'selected' : ''}>17 dezenas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estratégia:</label>
                            <select id="estrategiaGeracao" class="form-control">
                                ${this.state.estrategias.map(estrategia => `
                                    <option value="${estrategia.id}" ${this.state.filtros.estrategia === estrategia.id ? 'selected' : ''}>
                                        ${estrategia.nome}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="LotoFacilApp.gerarJogos()">Gerar Jogos</button>
                            <button class="btn btn-secondary" onclick="LotoFacilApp.limparJogos()">Limpar</button>
                            <button class="btn btn-success" onclick="LotoFacilApp.salvarJogos()">Salvar Jogos</button>
                        </div>
                        <div id="jogosGeradosContainer" style="margin-top: 15px;">
                            ${this.jogosGeradosTemplate()}
                        </div>
                    </div>
                `;
            },

            jogosGeradosTemplate() {
                if (this.state.jogosGerados.length === 0) {
                    return '<p class="no-games">Nenhum jogo gerado ainda.</p>';
                }
                
                return `
                    <h3>Seus Jogos Gerados (${this.state.jogosGerados.length})</h3>
                    <div class="jogos-grid">
                        ${this.state.jogosGerados.map((jogo, index) => `
                            <div class="jogo-card">
                                <div class="jogo-header">
                                    <span class="jogo-id">Jogo ${index + 1}</span>
                                    <span class="estrategia-badge">${this.getNomeEstrategia(jogo.estrategia)} (${jogo.numeros.length} dezenas)</span>
                                </div>
                                <div class="numeros-jogo">
                                    ${jogo.numeros.map(num => `
                                        <span class="numero ${this.isNumeroAtrasado(num) ? 'numero-atrasado' : ''}"
                                            title="${this.isNumeroAtrasado(num) ? `Atrasado há ${this.state.estatisticasAvancadas.atrasos[num]} concursos` : ''}">
                                            ${num.toString().padStart(2, '0')}
                                        </span>
                                    `).join('')}
                                </div>
                                <div class="jogo-footer">
                                    <small>${jogo.numeros.join(', ')}</small>
                                    <button class="btn-icon" onclick="LotoFacilApp.removerJogo(${index})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            },

            analiseTemplate() {
                return `
                    <div class="card animate">
                        <h2>Análise de Frequência</h2>
                        <div class="frequencia-chart">
                            ${this.state.frequenciaNumeros.map((freq, index) => `
                                <div class="frequencia-item" title="Número ${index + 1} - ${freq} ocorrências">
                                    <div class="frequencia-bar" style="height: ${(freq / Math.max(...this.state.frequenciaNumeros)) * 100}%"></div>
                                    <div class="frequencia-label">${index + 1}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="frequencia-legenda">
                            <div><span class="legenda-color max"></span> Mais frequentes</div>
                            <div><span class="legenda-color min"></span> Menos frequentes</div>
                        </div>
                    </div>
                `;
            },

            estatisticasTemplate() {
                if (!this.state.estatisticasCalculadas) return '<div class="card">Carregando estatísticas...</div>';
                
                return `
                    <div class="card estatisticas-card">
                        <h2>Estatísticas Avançadas</h2>
                        <div class="estatisticas-grid">
                            <div>
                                <h3>Top 10 Números</h3>
                                <ol>
                                    ${[...this.state.frequenciaNumeros]
                                        .map((freq, idx) => ({ num: idx + 1, freq }))
                                        .sort((a, b) => b.freq - a.freq)
                                        .slice(0, 10)
                                        .map(item => `
                                            <li>Número ${item.num} - ${item.freq} vezes</li>
                                        `).join('')}
                                </ol>
                            </div>
                            <div>
                                <h3>Sequências Mais Comuns</h3>
                                <ol>
                                    ${this.state.estatisticasAvancadas.sequencias.map(([seq, count]) => `
                                        <li>${seq} - ${count} ocorrências</li>
                                    `).join('')}
                                </ol>
                            </div>
                            <div>
                                <h3>Distribuição por Dezenas</h3>
                                <div class="dezenas-distribuicao">
                                    <div>
                                        <h4>1-10</h4>
                                        <div class="dezena-bar" style="width: ${(this.state.estatisticasAvancadas.padroes[0] / (this.state.ultimosResultadosAnalisados.length * 15)) * 100}%"></div>
                                        <span>${Math.round((this.state.estatisticasAvancadas.padroes[0] / (this.state.ultimosResultadosAnalisados.length * 15)) * 100)}%</span>
                                    </div>
                                    <div>
                                        <h4>11-20</h4>
                                        <div class="dezena-bar" style="width: ${(this.state.estatisticasAvancadas.padroes[1] / (this.state.ultimosResultadosAnalisados.length * 15)) * 100}%"></div>
                                        <span>${Math.round((this.state.estatisticasAvancadas.padroes[1] / (this.state.ultimosResultadosAnalisados.length * 15)) * 100)}%</span>
                                    </div>
                                    <div>
                                        <h4>21-25</h4>
                                        <div class="dezena-bar" style="width: ${(this.state.estatisticasAvancadas.padroes[2] / (this.state.ultimosResultadosAnalisados.length * 15)) * 100}%"></div>
                                        <span>${Math.round((this.state.estatisticasAvancadas.padroes[2] / (this.state.ultimosResultadosAnalisados.length * 15)) * 100)}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            ciclosTemplate() {
                if (!this.state.estatisticasCalculadas) return '';
                
                const atrasos = this.state.estatisticasAvancadas.atrasos;
                const numerosOrdenados = Object.entries(atrasos)
                    .sort((a, b) => b[1] - a[1])
                    .map(([num]) => parseInt(num));
                
                return `
                    <div class="card animate">
                        <h2>Ciclos de Atraso</h2>
                        <p>Quantidade de concursos desde a última aparição de cada número:</p>
                        <div class="ciclos-grid">
                            ${numerosOrdenados.map(num => `
                                <div class="ciclo-item ${atrasos[num] > 10 ? 'destaque' : ''}">
                                    <span class="numero-ciclo">${num.toString().padStart(2, '0')}</span>
                                    <div class="ciclo-bar-container">
                                        <div class="ciclo-bar" style="width: ${Math.min(100, atrasos[num] * 5)}%"></div>
                                        <span class="ciclo-value">${atrasos[num]} concursos</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="ciclo-actions">
                            <button class="btn btn-sm" onclick="LotoFacilApp.gerarJogoCiclos()">
                                Gerar Jogo com Números Mais Atrasados
                            </button>
                        </div>
                    </div>
                `;
            },

            estrategiasTemplate() {
                return `
                    <div class="card estrategias-card">
                        <h2>Estratégias Disponíveis</h2>
                        <div class="estrategias-grid">
                            ${this.state.estrategias.map(estrategia => `
                                <div class="estrategia-item">
                                    <h3>${estrategia.nome}</h3>
                                    <p>${estrategia.descricao}</p>
                                    <small class="referencia">Referência: ${estrategia.referencia}</small>
                                    <button class="btn btn-sm" onclick="LotoFacilApp.usarEstrategia('${estrategia.id}')">
                                        Usar Esta Estratégia
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            verificadorTemplate() {
                return `
                    <div class="card verificador-card">
                        <h2>Verificador de Jogos</h2>
                        <div class="form-group">
                            <label>Insira seus números (separados por vírgula):</label>
                            <input type="text" id="numerosVerificar" class="form-control" placeholder="Ex: 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15">
                        </div>
                        <div class="form-group">
                            <label>Tipo de jogo:</label>
                            <select id="tipoJogoVerificar" class="form-control">
                                <option value="15">15 dezenas</option>
                                <option value="16">16 dezenas</option>
                                <option value="17">17 dezenas</option>
                            </select>
                        </div>
                        <button class="btn" onclick="LotoFacilApp.verificarJogo()">Verificar Jogo</button>
                        <div id="resultadoVerificacao" style="margin-top: 15px;"></div>
                    </div>
                `;
            },

            historicoTemplate() {
                if (this.state.ultimosResultadosAnalisados.length === 0) return '';
                
                return `
                    <div class="card historico-card">
                        <h2>Últimos Resultados (${this.state.ultimosResultadosAnalisados.length})</h2>
                        <div class="historico-table-container">
                            <table class="historico-table">
                                <thead>
                                    <tr>
                                        <th>Concurso</th>
                                        <th>Data</th>
                                        <th>Números Sorteados</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${this.state.ultimosResultadosAnalisados.slice(0, 10).map(resultado => `
                                        <tr>
                                            <td>${resultado.concurso}</td>
                                            <td>${resultado.data}</td>
                                            <td>
                                                <div class="numeros-sorteio">
                                                    ${resultado.numeros.map(num => `
                                                        <span class="numero ${this.isNumeroQuente(num) ? 'numero-quente' : ''}">
                                                            ${num.toString().padStart(2, '0')}
                                                        </span>
                                                    `).join('')}
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        ${this.state.ultimosResultadosAnalisados.length > 10 ? `
                            <button class="btn btn-sm" onclick="LotoFacilApp.mostrarTodosResultados()">
                                Ver Todos (${this.state.ultimosResultadosAnalisados.length})
                            </button>
                        ` : ''}
                    </div>
                `;
            },

            painelAdminTemplate() {
                return `
                    <div id="painelAdminModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="LotoFacilApp.fecharModal('painelAdminModal')">&times;</span>
                            <h2>Painel Administrativo</h2>
                            
                            <div class="admin-section">
                                <h3>Gerenciamento de Dados</h3>
                                <button class="btn" onclick="LotoFacilApp.forcarAtualizacao()">
                                    Forçar Atualização de Dados
                                </button>
                                <button class="btn btn-warning" onclick="LotoFacilApp.limparCache()">
                                    Limpar Cache Local
                                </button>
                            </div>
                            
                            <div class="admin-section">
                                <h3>Estatísticas do Sistema</h3>
                                <p>Total de concursos carregados: ${this.state.resultados.length}</p>
                                <p>Última atualização: ${new Date().toLocaleString()}</p>
                            </div>
                            
                            <div class="admin-section">
                                <h3>Gerenciamento de Usuários</h3>
                                <div class="form-group">
                                    <input type="text" id="novoUsuario" placeholder="Novo usuário" class="form-control">
                                </div>
                                <div class="form-group">
                                    <input type="password" id="novaSenha" placeholder="Nova senha" class="form-control">
                                </div>
                                <button class="btn btn-success" onclick="LotoFacilApp.criarUsuario()">
                                    Criar Novo Usuário
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            // MÉTODOS DE GERAÇÃO DE JOGOS
            gerarNumerosAleatorios(quantidade = 15) {
                const numeros = [];
                while (numeros.length < quantidade) {
                    const num = Math.floor(Math.random() * 25) + 1;
                    if (!numeros.includes(num)) numeros.push(num);
                }
                return numeros.sort((a, b) => a - b);
            },

            gerarJogoBalanceado(quantidade = 15) {
                // Calcula proporção de pares e ímpares
                const paresDesejados = Math.round(quantidade * 0.5); // Cerca de 50% pares
                const imparesDesejados = quantidade - paresDesejados;
                
                const pares = [];
                const impares = [];
                
                // Gera números pares
                while (pares.length < paresDesejados) {
                    const num = Math.floor(Math.random() * 12) * 2 + 2;
                    if (!pares.includes(num)) pares.push(num);
                }
                
                // Gera números ímpares
                while (impares.length < imparesDesejados) {
                    const num = Math.floor(Math.random() * 12) * 2 + 1;
                    if (!impares.includes(num)) impares.push(num);
                }
                
                return [...pares, ...impares].sort((a, b) => a - b);
            },

            gerarJogoPorDezenas(quantidade = 15) {
                const dezenas = [
                    [1, 10],   // 1-10
                    [11, 20],  // 11-20
                    [21, 25]   // 21-25
                ];
                
                // Calcula distribuição proporcional
                const proporcao1 = Math.round(quantidade * 0.4); // 40% para 1-10
                const proporcao2 = Math.round(quantidade * 0.4); // 40% para 11-20
                const proporcao3 = quantidade - proporcao1 - proporcao2; // Restante para 21-25
                
                const distribuicao = [proporcao1, proporcao2, proporcao3];
                
                const jogo = [];
                
                distribuicao.forEach((quant, index) => {
                    const [min, max] = dezenas[index];
                    let count = 0;
                    
                    while (count < quant) {
                        const num = Math.floor(Math.random() * (max - min + 1)) + min;
                        if (!jogo.includes(num)) {
                            jogo.push(num);
                            count++;
                        }
                    }
                });
                
                return jogo.sort((a, b) => a - b);
            },

            gerarJogoNumerosQuentes(quantidade = 15) {
                if (this.state.ultimosResultadosAnalisados.length < 5) {
                    return this.gerarNumerosAleatorios(quantidade);
                }
                
                // Pega os últimos 5 concursos
                const ultimos5 = this.state.ultimosResultadosAnalisados.slice(-5);
                const numerosQuentes = {};
                
                // Conta frequência nos últimos 5 concursos
                ultimos5.forEach(concurso => {
                    concurso.numeros.forEach(num => {
                        numerosQuentes[num] = (numerosQuentes[num] || 0) + 1;
                    });
                });
                
                // Ordena por frequência
                const quentesOrdenados = Object.entries(numerosQuentes)
                    .sort((a, b) => b[1] - a[1])
                    .map(([num]) => parseInt(num));
                
                // Pega 30-40% de números quentes
                const qtdQuentes = Math.max(5, Math.round(quantidade * 0.35));
                const quentes = quentesOrdenados.slice(0, qtdQuentes);
                
                // Completa com números aleatórios
                const restantes = quantidade - quentes.length;
                const outrosNumeros = [];
                
                while (outrosNumeros.length < restantes) {
                    const num = Math.floor(Math.random() * 25) + 1;
                    if (!quentes.includes(num) && !outrosNumeros.includes(num)) {
                        outrosNumeros.push(num);
                    }
                }
                
                return [...quentes, ...outrosNumeros].sort((a, b) => a - b);
            },

            gerarJogoNumerosFrios(quantidade = 15) {
                if (!this.state.estatisticasAvancadas.atrasos) {
                    return this.gerarNumerosAleatorios(quantidade);
                }
                
                const atrasos = this.state.estatisticasAvancadas.atrasos;
                const frios = Object.entries(atrasos)
                    .filter(([_, atraso]) => atraso > 10)
                    .map(([num]) => parseInt(num));
                
                if (frios.length === 0) {
                    return this.gerarNumerosAleatorios(quantidade);
                }
                
                // Seleciona 20-30% de números frios
                const qtdFrios = Math.max(2, Math.round(quantidade * 0.25));
                const friosSelecionados = [];
                
                while (friosSelecionados.length < qtdFrios && friosSelecionados.length < frios.length) {
                    const randomIndex = Math.floor(Math.random() * frios.length);
                    const num = frios[randomIndex];
                    if (!friosSelecionados.includes(num)) {
                        friosSelecionados.push(num);
                    }
                }
                
                // Completa com números aleatórios
                const restantes = quantidade - friosSelecionados.length;
                const outrosNumeros = [];
                
                while (outrosNumeros.length < restantes) {
                    const num = Math.floor(Math.random() * 25) + 1;
                    if (!friosSelecionados.includes(num) && !outrosNumeros.includes(num)) {
                        outrosNumeros.push(num);
                    }
                }
                
                return [...friosSelecionados, ...outrosNumeros].sort((a, b) => a - b);
            },

            gerarJogoDezenasForaCiclo(quantidade = 15) {
                if (!this.state.estatisticasAvancadas.atrasos) {
                    return this.gerarNumerosAleatorios(quantidade);
                }
                
                const atrasos = this.state.estatisticasAvancadas.atrasos;
                const foraCiclo = Object.entries(atrasos)
                    .filter(([_, atraso]) => atraso > 5)
                    .map(([num]) => parseInt(num));
                
                if (foraCiclo.length === 0) {
                    return this.gerarNumerosAleatorios(quantidade);
                }
                
                // Seleciona até 'quantidade' números fora do ciclo
                const jogo = [];
                const maxNumeros = Math.min(quantidade, foraCiclo.length);
                
                while (jogo.length < maxNumeros) {
                    const randomIndex = Math.floor(Math.random() * foraCiclo.length);
                    const num = foraCiclo[randomIndex];
                    if (!jogo.includes(num)) {
                        jogo.push(num);
                    }
                }
                
                // Se não tiver a quantidade desejada, completa com aleatórios
                if (jogo.length < quantidade) {
                    const restantes = quantidade - jogo.length;
                    const outrosNumeros = [];
                    
                    while (outrosNumeros.length < restantes) {
                        const num = Math.floor(Math.random() * 25) + 1;
                        if (!jogo.includes(num) && !outrosNumeros.includes(num)) {
                            outrosNumeros.push(num);
                        }
                    }
                    
                    jogo.push(...outrosNumeros);
                }
                
                return jogo.sort((a, b) => a - b);
            },

            gerarJogoCiclosDezenas(quantidade = 15) {
                if (!this.state.estatisticasAvancadas.atrasos) {
                    return this.gerarNumerosAleatorios(quantidade);
                }
                
                const atrasos = this.state.estatisticasAvancadas.atrasos;
                const numerosOrdenados = Object.entries(atrasos)
                    .sort((a, b) => b[1] - a[1])
                    .map(([num]) => parseInt(num));
                
                // Pega os 'quantidade' números mais atrasados
                let jogo = numerosOrdenados.slice(0, quantidade);
                
                // Balanceia pares e ímpares se necessário
                const pares = jogo.filter(n => n % 2 === 0).length;
                if (pares < Math.floor(quantidade * 0.4) || pares > Math.ceil(quantidade * 0.6)) {
                    jogo = this.balancearParesImpares(jogo, quantidade);
                }
                
                return jogo.sort((a, b) => a - b);
            },

            gerarJogoCompleto(quantidade = 15) {
                // Combina múltiplas estratégias
                const quentes = this.gerarJogoNumerosQuentes(Math.round(quantidade * 0.35)).slice(0, Math.round(quantidade * 0.35));
                const frios = this.gerarJogoNumerosFrios(Math.round(quantidade * 0.25)).slice(0, Math.round(quantidade * 0.25));
                const ciclos = this.gerarJogoCiclosDezenas(Math.round(quantidade * 0.4)).slice(0, Math.round(quantidade * 0.4));
                
                // Combina todos, eliminando duplicatas
                const combinado = [...new Set([...quentes, ...frios, ...ciclos])];
                
                // Se tiver menos que o necessário, completa com aleatórios
                if (combinado.length < quantidade) {
                    const restantes = quantidade - combinado.length;
                    const aleatorios = this.gerarNumerosAleatorios(restantes);
                    combinado.push(...aleatorios);
                }
                // Se tiver mais que o necessário, remove os menos atrasados
                else if (combinado.length > quantidade) {
                    const atrasos = this.state.estatisticasAvancadas.atrasos;
                    combinado.sort((a, b) => atrasos[b] - atrasos[a]);
                    combinado.splice(quantidade);
                }
                
                return combinado.sort((a, b) => a - b);
            },

            balancearParesImpares(jogo, quantidade = 15) {
                const pares = jogo.filter(n => n % 2 === 0);
                const impares = jogo.filter(n => n % 2 !== 0);
                
                const paresDesejados = Math.round(quantidade * 0.5); // Cerca de 50% pares
                const imparesDesejados = quantidade - paresDesejados;
                
                // Se tiver muitos pares, remove alguns
                while (pares.length > paresDesejados) {
                    const randomIndex = Math.floor(Math.random() * pares.length);
                    pares.splice(randomIndex, 1);
                }
                
                // Se tiver muitos ímpares, remove alguns
                while (impares.length > imparesDesejados) {
                    const randomIndex = Math.floor(Math.random() * impares.length);
                    impares.splice(randomIndex, 1);
                }
                
                // Se tiver poucos pares, adiciona mais
                while (pares.length < paresDesejados) {
                    const num = Math.floor(Math.random() * 12) * 2 + 2;
                    if (!pares.includes(num) && !impares.includes(num)) {
                        pares.push(num);
                    }
                }
                
                // Se tiver poucos ímpares, adiciona mais
                while (impares.length < imparesDesejados) {
                    const num = Math.floor(Math.random() * 12) * 2 + 1;
                    if (!impares.includes(num) && !pares.includes(num)) {
                        impares.push(num);
                    }
                }
                
                return [...pares, ...impares].sort((a, b) => a - b);
            },

            // MÉTODOS DE INTERFACE
            gerarJogos() {
                const quantity = parseInt(document.getElementById('quantidadeJogos').value) || 1;
                const estrategia = document.getElementById('estrategiaGeracao').value;
                const dezenas = parseInt(document.getElementById('quantidadeDezenas').value) || 15;
                
                this.setState({
                    filtros: {
                        ...this.state.filtros,
                        estrategia,
                        dezenas
                    }
                });
                
                const jogos = [];
                for (let i = 0; i < quantity; i++) {
                    let game;
                    switch (estrategia) {
                        case 'aleatorio': game = this.gerarNumerosAleatorios(dezenas); break;
                        case 'balanceado': game = this.gerarJogoBalanceado(dezenas); break;
                        case 'dezenas': game = this.gerarJogoPorDezenas(dezenas); break;
                        case 'quentes': game = this.gerarJogoNumerosQuentes(dezenas); break;
                        case 'frios': game = this.gerarJogoNumerosFrios(dezenas); break;
                        case 'dezenasforadociclo': game = this.gerarJogoDezenasForaCiclo(dezenas); break;
                        case 'ciclos': game = this.gerarJogoCiclosDezenas(dezenas); break;
                        case 'completo': game = this.gerarJogoCompleto(dezenas); break;
                        default: game = this.gerarNumerosAleatorios(dezenas);
                    }
                    
                    jogos.push({
                        numeros: game,
                        estrategia: estrategia,
                        data: new Date().toLocaleString()
                    });
                }
                
                this.setState({
                    jogosGerados: [...this.state.jogosGerados, ...jogos]
                });
            },

            gerarJogoCiclos() {
                const dezenas = parseInt(document.getElementById('quantidadeDezenas').value) || 15;
                const game = this.gerarJogoCiclosDezenas(dezenas);
                this.setState({
                    jogosGerados: [...this.state.jogosGerados, {
                        numeros: game,
                        estrategia: 'ciclos',
                        data: new Date().toLocaleString()
                    }]
                });
            },

            limparJogos() {
                this.setState({ jogosGerados: [] });
            },

            removerJogo(index) {
                const jogos = [...this.state.jogosGerados];
                jogos.splice(index, 1);
                this.setState({ jogosGerados: jogos });
            },

            salvarJogos() {
                if (this.state.jogosGerados.length === 0) {
                    alert('Nenhum jogo para salvar!');
                    return;
                }
                
                try {
                    const jogosParaSalvar = {
                        data: new Date().toLocaleString(),
                        jogos: this.state.jogosGerados
                    };
                    
                    localStorage.setItem('lotoJogosSalvos', JSON.stringify(jogosParaSalvar));
                    alert('Jogos salvos com sucesso!');
                } catch (e) {
                    alert('Erro ao salvar jogos: ' + e.message);
                }
            },

            usarEstrategia(id) {
                document.getElementById('estrategiaGeracao').value = id;
                this.setState({
                    filtros: { ...this.state.filtros, estrategia: id }
                });
                alert(`Estratégia "${this.getNomeEstrategia(id)}" selecionada!`);
            },

            verificarJogo() {
                const input = document.getElementById('numerosVerificar').value;
                const tipoJogo = parseInt(document.getElementById('tipoJogoVerificar').value) || 15;
                const numeros = input.split(',')
                    .map(num => parseInt(num.trim()))
                    .filter(num => !isNaN(num) && num >= 1 && num <= 25);
                
                if (numeros.length !== tipoJogo || new Set(numeros).size !== tipoJogo) {
                    document.getElementById('resultadoVerificacao').innerHTML = `
                        <div class="alert alert-danger">
                            Jogo inválido! Por favor, insira exatamente ${tipoJogo} números únicos entre 1 e 25.
                        </div>
                    `;
                    return;
                }
                
                const numerosOrdenados = [...numeros].sort((a, b) => a - b);
                const atrasos = numeros.map(num => this.state.estatisticasAvancadas.atrasos[num] || 0);
                const pares = numeros.filter(num => num % 2 === 0).length;
                const impares = numeros.length - pares;
                
                // Verifica distribuição por dezenas
                const dezenas = {
                    '1-10': numeros.filter(num => num <= 10).length,
                    '11-20': numeros.filter(num => num > 10 && num <= 20).length,
                    '21-25': numeros.filter(num => num > 20).length
                };
                
                // Verifica números quentes (últimos 5 concursos)
                let quentes = 0;
                if (this.state.ultimosResultadosAnalisados.length >= 5) {
                    const ultimos5 = this.state.ultimosResultadosAnalisados.slice(-5);
                    const numerosQuentes = new Set();
                    
                    ultimos5.forEach(concurso => {
                        concurso.numeros.forEach(num => numerosQuentes.add(num));
                    });
                    
                    quentes = numeros.filter(num => numerosQuentes.has(num)).length;
                }
                
                // Verifica números frios (atraso > 10)
                const frios = numeros.filter(num => this.state.estatisticasAvancadas.atrasos[num] > 10).length;
                
                // Monta resultado
                let html = `
                    <div class="card">
                        <h3>Análise do Seu Jogo (${tipoJogo} dezenas)</h3>
                        <div class="numeros-jogo">
                            ${numerosOrdenados.map(num => `
                                <span class="numero ${this.isNumeroAtrasado(num) ? 'numero-atrasado' : ''}"
                                    title="${this.isNumeroAtrasado(num) ? `Atrasado há ${this.state.estatisticasAvancadas.atrasos[num]} concursos` : ''}">
                                    ${num.toString().padStart(2, '0')}
                                </span>
                            `).join('')}
                        </div>
                        
                        <div class="analise-grid">
                            <div>
                                <h4>Balanceamento</h4>
                                <p>Pares: ${pares} | Ímpares: ${impares}</p>
                                <p>${pares >= Math.floor(tipoJogo * 0.4) && pares <= Math.ceil(tipoJogo * 0.6) ? '✅ Balanceado' : '⚠️ Poucos/muitos pares'}</p>
                            </div>
                            <div>
                                <h4>Distribuição por Dezenas</h4>
                                <p>1-10: ${dezenas['1-10']} | 11-20: ${dezenas['11-20']} | 21-25: ${dezenas['21-25']}</p>
                                <p>${dezenas['1-10'] >= Math.floor(tipoJogo * 0.3) && dezenas['1-10'] <= Math.ceil(tipoJogo * 0.5) && 
                                   dezenas['11-20'] >= Math.floor(tipoJogo * 0.3) && dezenas['11-20'] <= Math.ceil(tipoJogo * 0.5) &&
                                   dezenas['21-25'] >= Math.floor(tipoJogo * 0.1) && dezenas['21-25'] <= Math.ceil(tipoJogo * 0.3) ? '✅ Bem distribuído' : '⚠️ Distribuição irregular'}</p>
                            </div>
                            <div>
                                <h4>Tendências</h4>
                                <p>Números quentes: ${quentes}</p>
                                <p>Números frios: ${frios}</p>
                                <p>${quentes >= Math.floor(tipoJogo * 0.3) && frios >= Math.floor(tipoJogo * 0.1) ? '✅ Boa combinação' : '⚠️ Pode melhorar'}</p>
                            </div>
                        </div>
                        
                        <h4>Estatísticas Detalhadas</h4>
                        <table class="analise-table">
                            <thead>
                                <tr>
                                    <th>Número</th>
                                    <th>Frequência</th>
                                    <th>Atraso</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${numerosOrdenados.map(num => `
                                    <tr>
                                        <td>${num.toString().padStart(2, '0')}</td>
                                        <td>${this.state.frequenciaNumeros[num - 1]} vezes</td>
                                        <td>${this.state.estatisticasAvancadas.atrasos[num] || 0} concursos</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('resultadoVerificacao').innerHTML = html;
            },

            aplicarFiltros() {
                const periodo = document.getElementById('filtroPeriodo').value;
                let anoInicio = document.getElementById('anoInicio')?.value;
                let anoFim = document.getElementById('anoFim')?.value;
                
                if (periodo === 'custom' && (!anoInicio || !anoFim)) {
                    alert('Por favor, preencha ambos os anos para filtro personalizado');
                    return;
                }
                
                this.setState({
                    filtros: {
                        ...this.state.filtros,
                        periodo,
                        anoInicio: anoInicio ? parseInt(anoInicio) : null,
                        anoFim: anoFim ? parseInt(anoFim) : null
                    },
                    loading: true
                });
                
                // Mostra/oculta campos de ano conforme necessário
                if (periodo === 'custom') {
                    document.getElementById('customRange').style.display = 'block';
                } else {
                    document.getElementById('customRange').style.display = 'none';
                }
                
                // Aplica os filtros
                setTimeout(() => {
                    this.filtrarResultados();
                }, 100);
            },

            filtrarResultados() {
                const { periodo, anoInicio, anoFim } = this.state.filtros;
                let resultadosFiltrados = [...this.state.resultados];
                
                // Filtra por período
                if (periodo !== 'all') {
                    const hoje = new Date();
                    let dataLimite = new Date();
                    
                    if (periodo === 'month') dataLimite.setMonth(hoje.getMonth() - 1);
                    else if (periodo === 'year') dataLimite.setFullYear(hoje.getFullYear() - 1);
                    
                    resultadosFiltrados = resultadosFiltrados.filter(r => {
                        const [dia, mes, ano] = r.data.split('/');
                        const dataResultado = new Date(`${ano}-${mes}-${dia}`);
                        return dataResultado >= dataLimite;
                    });
                }
                
                // Filtra por ano personalizado
                if (periodo === 'custom' && anoInicio && anoFim) {
                    resultadosFiltrados = resultadosFiltrados.filter(r => {
                        const ano = parseInt(r.data.split('/')[2]);
                        return ano >= anoInicio && ano <= anoFim;
                    });
                }
                
                this.setState({
                    ultimosResultadosAnalisados: resultadosFiltrados,
                    loading: false
                });
                
                this.calcularFrequenciaNumeros(resultadosFiltrados);
                this.calcularEstatisticasAvancadas(resultadosFiltrados);
            },

            mostrarTodosResultados() {
                alert(`Mostrando todos os ${this.state.ultimosResultadosAnalisados.length} resultados`);
                // Aqui você poderia implementar um modal ou expandir a tabela
            },

            // MÉTODOS DE AUTENTICAÇÃO
            handleLogin() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Simulação de autenticação
                if ((username === 'admin' && password === 'admin123') || 
                    (username === 'user' && password === '123')) {
                    
                    const user = { 
                        username, 
                        isAdmin: username === 'admin',
                        lastLogin: new Date().toLocaleString()
                    };
                    
                    this.setState({ user });
                    localStorage.setItem('lotoUser', JSON.stringify(user));
                    this.loadData();
                } else {
                    alert('Credenciais inválidas! Tente novamente.');
                }
            },

            logout() {
                this.setState({ user: null });
                localStorage.removeItem('lotoUser');
            },

            // MÉTODOS AUXILIARES
            getNomeEstrategia(id) {
                const estrategia = this.state.estrategias.find(e => e.id === id);
                return estrategia ? estrategia.nome : 'Desconhecida';
            },

            getDescricaoEstrategia(id) {
                const estrategia = this.state.estrategias.find(e => e.id === id);
                return estrategia ? estrategia.descricao : 'Estratégia não especificada';
            },

            isNumeroAtrasado(num) {
                return this.state.estatisticasAvancadas.atrasos[num] > 10;
            },

            isNumeroQuente(num) {
                if (this.state.ultimosResultadosAnalisados.length < 5) return false;
                
                const ultimos5 = this.state.ultimosResultadosAnalisados.slice(-5);
                for (let i = 0; i < ultimos5.length; i++) {
                    if (ultimos5[i].numeros.includes(num)) return true;
                }
                return false;
            },

            // MÉTODOS DO PAINEL ADMIN
            renderPainelAdmin() {
                if (!document.getElementById('painelAdminModal')) {
                    document.body.insertAdjacentHTML('beforeend', this.painelAdminTemplate());
                }
            },

            mostrarPainelAdmin() {
                const modal = document.getElementById('painelAdminModal');
                if (modal) modal.style.display = 'block';
            },

            fecharModal(id) {
                const modal = document.getElementById(id);
                if (modal) modal.style.display = 'none';
            },

            forcarAtualizacao() {
                this.setState({ loading: true });
                localStorage.removeItem('lotoResults');
                this.loadData();
                this.fecharModal('painelAdminModal');
            },

            limparCache() {
                localStorage.clear();
                alert('Cache limpo com sucesso!');
                this.fecharModal('painelAdminModal');
            },

            criarUsuario() {
                // Em um sistema real, isso seria enviado para um backend
                alert('Funcionalidade de criar usuário seria implementada aqui');
                this.fecharModal('painelAdminModal');
            },

            // CONFIGURAÇÃO INICIAL
            setupEventListeners() {
                // Configura eventos quando o DOM estiver pronto
                document.addEventListener('DOMContentLoaded', () => {
                    // Evento para mostrar/ocultar campos de ano personalizado
                    document.getElementById('filtroPeriodo')?.addEventListener('change', (e) => {
                        const customRange = document.getElementById('customRange');
                        if (e.target.value === 'custom') {
                            customRange.style.display = 'block';
                        } else {
                            customRange.style.display = 'none';
                        }
                    });
                });
            }
        };

        // Inicializa o app quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            LotoFacilApp.init();
        });
    </script>
</body>
</html>
