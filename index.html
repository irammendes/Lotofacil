<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loto Fácil Analytics Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .numero {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background-color: #007bff;
            color: white;
            border-radius: 50%;
            margin: 3px;
            font-weight: bold;
        }
        .missing {
            background-color: #dc3545;
        }
        .game-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        select, input {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gerador de Jogos Lotofácil</h1>
            <button class="btn btn-primary" id="generateBtn">Gerar Jogos</button>
        </div>
        
        <div class="controls">
            <div>
                <label>Quantidade de jogos:</label>
                <select id="gameQuantity">
                    <option value="1">1</option>
                    <option value="3">3</option>
                    <option value="5" selected>5</option>
                    <option value="10">10</option>
                </select>
            </div>
            <div>
                <label>Dezenas faltantes:</label>
                <select id="missingRange">
                    <option value="4-5">4-5</option>
                    <option value="3-6">3-6</option>
                </select>
            </div>
        </div>
        
        <div id="resultsContainer">
            <p>Clique em "Gerar Jogos" para criar suas combinações</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dados de exemplo (serão substituídos pelos da API)
            const sampleData = [
                { concurso: 2900, data: "01/04/2025", numeros: [1, 2, 3, 5, 8, 9, 12, 14, 16, 18, 20, 21, 23, 24, 25] },
                { concurso: 2899, data: "30/03/2025", numeros: [3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 22, 23, 24, 25, 10] }
            ];
            
            let resultados = sampleData;
            
            // Tentar carregar dados da API
            fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil')
                .then(response => response.ok ? response.json() : Promise.reject())
                .then(data => {
                    resultados = Array.isArray(data) ? data : [data];
                    resultados = resultados.map(item => ({
                        concurso: item.numero,
                        data: item.dataApuracao,
                        numeros: item.listaDezenas.map(Number).sort((a, b) => a - b)
                    }));
                })
                .catch(() => {
                    console.log("Usando dados locais");
                });
            
            // Gerar jogos com estratégia de dezenas faltantes
            document.getElementById('generateBtn').addEventListener('click', function() {
                const quantity = parseInt(document.getElementById('gameQuantity').value);
                const [minMissing, maxMissing] = document.getElementById('missingRange').value.split('-').map(Number);
                
                const missingNumbers = getMissingNumbers();
                const generatedGames = [];
                
                for (let i = 0; i < quantity; i++) {
                    generatedGames.push(generateGame(missingNumbers, minMissing, maxMissing));
                }
                
                displayGames(generatedGames, missingNumbers);
            });
            
            function getMissingNumbers() {
                // Pega números dos últimos 5 concursos
                const last5 = resultados.slice(0, 5);
                const drawnNumbers = new Set();
                
                last5.forEach(result => {
                    result.numeros.forEach(num => drawnNumbers.add(num));
                });
                
                // Encontra números de 1 a 25 que não foram sorteados
                const allNumbers = Array.from({length: 25}, (_, i) => i + 1);
                return allNumbers.filter(num => !drawnNumbers.has(num));
            }
            
            function generateGame(missingNumbers, minMissing, maxMissing) {
                const missingCount = Math.floor(Math.random() * (maxMissing - minMissing + 1)) + minMissing;
                const selectedMissing = shuffleArray([...missingNumbers]).slice(0, missingCount);
                
                // Pega números que foram sorteados recentemente
                const regularNumbers = Array.from({length: 25}, (_, i) => i + 1)
                    .filter(num => !missingNumbers.includes(num));
                
                const regularCount = 15 - missingCount;
                const selectedRegular = shuffleArray(regularNumbers).slice(0, regularCount);
                
                return {
                    numbers: [...selectedMissing, ...selectedRegular].sort((a, b) => a - b),
                    missing: selectedMissing
                };
            }
            
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            
            function displayGames(games, allMissing) {
                const container = document.getElementById('resultsContainer');
                
                if (games.length === 0) {
                    container.innerHTML = '<p>Não foi possível gerar jogos no momento.</p>';
                    return;
                }
                
                let html = `
                    <h3>Dezenas faltantes nos últimos concursos: 
                        ${allMissing.map(n => n.toString().padStart(2, '0')).join(', ') || 'Nenhuma'}
                    </h3>
                `;
                
                games.forEach((game, index) => {
                    html += `
                        <div class="game-card">
                            <h4>Jogo ${index + 1}</h4>
                            <div>
                                ${game.numbers.map(num => `
                                    <span class="numero ${game.missing.includes(num) ? 'missing' : ''}" 
                                          title="${game.missing.includes(num) ? 'Dezena faltante' : 'Dezena recente'}">
                                        ${num.toString().padStart(2, '0')}
                                    </span>
                                `).join('')}
                            </div>
                            <p>${game.numbers.join(', ')}</p>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
        });
    </script>
</body>
</html>
